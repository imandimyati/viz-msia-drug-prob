<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="chrome=1">
  <title>Visualising Malaysia&#39;s Drug Abuse Issues</title>
  <link rel="stylesheet" href="stylesheets/styles.css">
  <link rel="stylesheet" href="stylesheets/github-light.css">
  <script src="//cdnjs.cloudflare.com/ajax/libs/d3/3.5.16/d3.min.js"></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/dimple/2.2.0/dimple.latest.min.js"></script>
  <meta name="viewport" content="width=device-width">
  <!--[if lt IE 9]>
  <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
  <![endif]-->
</head>
<body>
  <div class="wrapper">
    <header>
      <h1>Drug Crimes: Offenses and Punishments</h1>
      <p>A look into drug-related offenses and punishments in Malaysia</p>
      <p class="view"><a href="https://imandimyati.github.io/viz-msia-drug-prob/main.html">The Costs of Tackling Drug Abuse<small><br>Looking at the costs of tackling drug abuse in Malaysia</small></a></p>
      <p class="view"><a href="https://imandimyati.github.io/viz-msia-drug-prob/art2.html">An In-Depth Look into Malaysia's Drug Addicts<small><br>Exploring the demographic data of drug addicts in Malaysia</small></a></p>
      <p class="view"><a href="https://imandimyati.github.io/viz-msia-drug-prob/art3.html">Drug Crimes: Offenses and Punishments<small><br>A look into drug-related offenses and punishments in Malaysia</small></a></p>
      <p class="view"><a href="https://imandimyati.github.io/viz-msia-drug-prob/art4.html">'Drugging' Down the Nation<small><br>Making sense of the social impact in relations to drug abuse in Malaysia</small></a></p>
      <a href="https://imandimyati.github.io/viz-msia-drug-prob/"><button>Home</button></a>
    </header>

    <section>
      <div id="urineChart">
        <h4>Police Arrest based on Urine Test: Numbers are still high</h4>

        <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Sed placerat eget dui at finibus. Aenean magna sapien, pellentesque a diam ac, sagittis volutpat sem.
          Quisque suscipit lorem nec tristique fringilla. Nam ultrices metus nulla, sed pretium libero tristique quis. Integer imperdiet aliquet ligula id blandit.
          Cras porttitor condimentum elit. Integer id finibus tellus. Aenean nec dapibus lorem, sed vulputate dolor. In iaculis risus ac aliquam blandit. Aliquam erat volutpat.
          Vestibulum erat odio, fringilla eu rutrum ut, euismod eget ipsum. Nullam at faucibus nisl. Sed ornare elit odio, eu ullamcorper sem tincidunt ac.</p>

        <script type="text/javascript">
        var svgOne = dimple.newSvg("#urineChart", 400, 215);
          d3.csv("datasets_csv/urine_test_caught.csv", function (dataOne) {
            console.log(dataOne)

            svgOne.append("text")
              .attr("x", 190)
              .attr("y", 8)
              .attr("text-anchor", "middle")
              .style("font-size", "10px")
              .style("font-weight", "bold")
              .text("Number of Police Arrest Based on Drug Positive Urine Test");

            var uriChart = new dimple.chart(svgOne, dataOne);
            uriChart.setBounds(65, 30, 252, 152);

            var xOne = uriChart.addCategoryAxis("x", "Year");
            xOne.addOrderRule("Date");

            var yOne = uriChart.addMeasureAxis("y", "Total");
            yOne.tickFormat = 'f';

            var sOne = uriChart.addSeries(null, dimple.plot.line);
              sOne.lineMarkers = true;
            uriChart.draw();
        });
        </script>
      </div>

      <div id="genderChart">
        <h4>Arrested and Remanded: Huge gap between men and women</h4>

        <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Sed placerat eget dui at finibus. Aenean magna sapien, pellentesque a diam ac, sagittis volutpat sem.
          Quisque suscipit lorem nec tristique fringilla. Nam ultrices metus nulla, sed pretium libero tristique quis. Integer imperdiet aliquet ligula id blandit.
          Cras porttitor condimentum elit. Integer id finibus tellus. Aenean nec dapibus lorem, sed vulputate dolor. In iaculis risus ac aliquam blandit. Aliquam erat volutpat.
          Vestibulum erat odio, fringilla eu rutrum ut, euismod eget ipsum. Nullam at faucibus nisl. Sed ornare elit odio, eu ullamcorper sem tincidunt ac.</p>

        <script type="text/javascript">
        var svgTwo = dimple.newSvg("#genderChart", 450, 300);
          d3.csv("datasets_csv/institution_case_caught.csv", function (dataTwo) {
              console.log(dataTwo);

              svgTwo.append("text")
                .attr("x", 180)
                .attr("y", 8)
                .attr("text-anchor", "middle")
                .style("font-size", "10px")
                .style("font-weight", "bold")
                .text("Number of People Arrested and Remanded");

              // Create the indicator chart on the right of the main chart
              var indicator = new dimple.chart(svgTwo, dataTwo);

              // Pick blue as the default and orange for the selected month
              var defaultColor = indicator.defaultColors[0];
              var indicatorColor = indicator.defaultColors[2];

              // The frame duration for the animation in milliseconds
              var frame = 3500;

              var firstTick = true;

              // Place the indicator bar chart to the right
              indicator.setBounds(324, 46, 65, 40, "right");

              // Add dates along the y axis
              var yTwo = indicator.addCategoryAxis("y", "Year");
              yTwo.addOrderRule("Date", true);

              // Bar size and hide the axis
              var xTwo = indicator.addMeasureAxis("x", "Total");
              xTwo.tickFormat = 'f';
              xTwo.hidden = true;

              // Add the bars to the indicator and add event handlers
              var sTwo = indicator.addSeries(null, dimple.plot.bar);
              sTwo.addEventHandler("click", onClick);
              // Draw the side chart
              indicator.draw();

              // Remove the title from the y axis
              yTwo.titleShape.remove();

              // Remove the lines from the y axis
              yTwo.shapes.selectAll("line,path").remove();

              // Move the y axis text inside the plot area
              yTwo.shapes.selectAll("text")
                      .style("text-anchor", "start")
                      .style("font-size", "9px")
                      .attr("transform", "translate(18, 0.5)");

              svgTwo.selectAll("title_text")
                      .data(["Click bar to select",
                          "and pause. Click again",
                          "to resume animation."])
                      .enter()
                      .append("text")
                      .attr("x", 325)
                      .attr("y", function (d, i) { return 18 + i * 12; })
                      .style("font-family", "sans-serif")
                      .style("font-size", "10px")
                      .style("color", "Black")
                      .text(function (d) { return d; });

              // Manually set the bar colors
              sTwo.shapes
                      .attr("rx", 10)
                      .attr("ry", 10)
                      .style("fill", function (d) { return (d.y === '2013' ? indicatorColor.fill : defaultColor.fill) })
                      .style("stroke", function (d) { return (d.y === '2013' ? indicatorColor.stroke : defaultColor.stroke) })
                      .style("opacity", 0.4);

              // Draw the main chart
              var bubbles = new dimple.chart(svgTwo, dataTwo);
              bubbles.setBounds(60, 25, 252, 152)
              bubbles.addCategoryAxis("x", ["Institution", "Crime"]);
              var yBubbles = bubbles.addMeasureAxis("y", "Total");
                yBubbles.tickFormat = 'f';
              var zBubbles = bubbles.addMeasureAxis("z", "Total");
                zBubbles.tickFormat = 'f';
              bubbles.addSeries("Gender", dimple.plot.bubble)

              var myLegendTwo = bubbles.addLegend(390, 110, 5, 180, "right");

              // Add a storyboard to the main chart and set the tick event
              var story = bubbles.setStoryboard("Year", onTick);
              // Change the frame duration
              story.frameDuration = frame;
              // Order the storyboard by date
              story.addOrderRule("Date");

              // Draw the bubble chart
              bubbles.draw();

              // Orphan the legends as they are consistent but by default they
              // will refresh on tick
              bubbles.legends = [];

              // Remove the storyboard label because the chart will indicate the
              // current month instead of the label
              story.storyLabel.remove();

              // On click of the side chart
              function onClick(e) {
                  // Pause the animation
                  story.pauseAnimation();
                  // If it is already selected resume the animation
                  // otherwise pause and move to the selected month
                  if (e.yValue === story.getFrameValue()) {
                      story.startAnimation();
                  } else {
                      story.goToFrame(e.yValue);
                      story.pauseAnimation();
                  }
              }

              // On tick of the main charts storyboard
              function onTick(e) {
                  if (!firstTick) {
                      // Color all shapes the same
                      sTwo.shapes
                              .transition()
                              .duration(frame / 2)
                              .style("fill", function (d) { return (d.y === e ? indicatorColor.fill : defaultColor.fill) })
                              .style("stroke", function (d) { return (d.y === e ? indicatorColor.stroke : defaultColor.stroke) });
                  }
                  firstTick = false;
              }

              svgTwo.selectAll("title_text")
                .data(["Click legend to", "show/hide gender:"])
                .enter()
                .append("text")
                  .attr("x", 325)
                  .attr("y", function (d, i) { return 105 + i * 12; })
                  .style("font-family", "sans-serif")
                  .style("font-size", "10px")
                  .style("color", "Black")
                  .text(function (d) { return d; });

              var filterValuesTwo = dimple.getUniqueValues(dataTwo, "Gender");

              myLegendTwo.shapes.selectAll("rect")
                // Add a click event to each rectangle
                .on("click", function (e) {
                  // This indicates whether the item is already visible or not
                  var hide = false;
                  var newFiltersTwo = [];
                  // If the filters contain the clicked shape hide it
                  filterValuesTwo.forEach(function (f) {
                    if (f === e.aggField.slice(-1)[0]) {
                      hide = true;
                    } else {
                      newFiltersTwo.push(f);
                    }
                  });
                  // Hide the shape or show it
                  if (hide) {
                    d3.select(this).style("opacity", 0.2);
                  } else {
                    newFiltersTwo.push(e.aggField.slice(-1)[0]);
                    d3.select(this).style("opacity", 0.9);
                  }
                  // Update the filters
                  filterValuesTwo = newFiltersTwo;
                  // Filter the data
                  bubbles.data = dimple.filterData(dataTwo, "Gender", filterValuesTwo);

                  bubbles.draw(800);
            });
          });
        </script>
      </div>

      <div id="crimeChart">
        <h4>Drug Crimes Committed: Despite harsh punishment, drug crimes still on the rise</h4>

        <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Sed placerat eget dui at finibus. Aenean magna sapien, pellentesque a diam ac, sagittis volutpat sem.
          Quisque suscipit lorem nec tristique fringilla. Nam ultrices metus nulla, sed pretium libero tristique quis. Integer imperdiet aliquet ligula id blandit.
          Cras porttitor condimentum elit. Integer id finibus tellus. Aenean nec dapibus lorem, sed vulputate dolor. In iaculis risus ac aliquam blandit. Aliquam erat volutpat.
          Vestibulum erat odio, fringilla eu rutrum ut, euismod eget ipsum. Nullam at faucibus nisl. Sed ornare elit odio, eu ullamcorper sem tincidunt ac.</p>

        <script type="text/javascript">
          var svgThree = dimple.newSvg("#crimeChart", 450, 300);
           d3.csv("datasets_csv/dda_1952_caught.csv", function (dataThree) {

             svgThree.append("text")
               .attr("x", 180)
               .attr("y", 8)
               .attr("text-anchor", "middle")
               .style("font-size", "10px")
               .style("font-weight", "bold")
               .text("Drug Crimes Committed Under DDA 1952");

             var criChart = new dimple.chart(svgThree, dataThree);
             criChart.setBounds(65, 20, 252, 152)

             var xThree = criChart.addCategoryAxis("x", "Year");
             xThree.addOrderRule("Date");

             var yThree = criChart.addMeasureAxis("y", "Total");
             yThree.tickFormat = 'f';

             var sThree = criChart.addSeries("Dangerous Drug Act, 1952", dimple.plot.bar);
             sThree.stacked = false;

             var myLegendThree = criChart.addLegend(458, 26, 5, 180, "right");

             criChart.draw();

             criChart.legends = [];

             svgThree.selectAll("title_text")
               .data(["Click legend to show/hide", "Sections of DDA 1952:"])
               .enter()
               .append("text")
                 .attr("x", 325)
                 .attr("y", function (d, i) { return 20 + i * 12; })
                 .style("font-family", "sans-serif")
                 .style("font-size", "10px")
                 .style("color", "Black")
                 .text(function (d) { return d; });

             var filterValuesThree = dimple.getUniqueValues(dataThree, "Dangerous Drug Act, 1952");

             myLegendThree.shapes.selectAll("rect")
               // Add a click event to each rectangle
               .on("click", function (e) {
                 // This indicates whether the item is already visible or not
                 var hide = false;
                 var newFiltersThree = [];
                 // If the filters contain the clicked shape hide it
                 filterValuesThree.forEach(function (f) {
                   if (f === e.aggField.slice(-1)[0]) {
                     hide = true;
                   } else {
                     newFiltersThree.push(f);
                   }
                 });
                 // Hide the shape or show it
                 if (hide) {
                   d3.select(this).style("opacity", 0.2);
                 } else {
                   newFiltersThree.push(e.aggField.slice(-1)[0]);
                   d3.select(this).style("opacity", 0.9);
                 }
                 // Update the filters
                 filterValuesThree = newFiltersThree;
                 // Filter the data
                 criChart.data = dimple.filterData(dataThree, "Dangerous Drug Act, 1952", filterValuesThree);

                 criChart.draw(800);
            });
         });
        </script>
      </div>

    </section>

  </div>
  <script src="javascripts/scale.fix.js"></script>
</html>
